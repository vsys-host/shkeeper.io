{% extends 'base.j2' %}

{% block body %}
    <div class="container login-container">
      <div class="row align-items-center h-100">
        <div class="col d-flex flex-column align-items-center justify-content-center">
          <img class="big-logo" width="200" src="{{ url_for('static', filename='images/vsys-logo.' + theme + '.png') }}" alt="logo" />

          <h3 class="mb-4">Enable Two-Factor Authentication</h3>

          {% for message in get_flashed_messages() %}
            <div class="alert alert-danger" role="alert">{{ message }}</div>
          {% endfor %}

          <div class="card mx-auto" style="max-width: 550px;">
            <div class="card-body">
              <h5 class="card-title mb-3">Step 1: Scan QR Code</h5>
              <p class="card-text">Use your authenticator app (Google Authenticator, Authy, Microsoft Authenticator) to scan this QR code:</p>

              <div class="text-center my-4">
                <div class="d-inline-block p-3 bg-white rounded">
                  <img src="data:image/png;base64,{{ qr_code }}" alt="QR Code" class="img-fluid" style="max-width: 250px;" />
                </div>
              </div>

              <h5 class="card-title mt-4 mb-3">Step 2: Manual Entry (Optional)</h5>
              <p class="card-text">If you can't scan the QR code, enter this secret manually:</p>
              <div class="alert alert-secondary text-center text-break" style="font-family: monospace; font-size: 0.875rem;">
                {{ secret }}
              </div>

              <h5 class="card-title mt-4 mb-3">Step 3: Verify Code</h5>
              <p class="card-text">Enter the 6-digit code from your authenticator app to complete setup:</p>

              <form method="post">
                <div class="mb-3">
                  <input
                    type="text"
                    name="token"
                    class="form-control text-center"
                    style="font-size: 1.25rem; letter-spacing: 0.25em; padding: 0.75rem;"
                    placeholder="000000"
                    maxlength="6"
                    pattern="[0-9]{6}"
                    autocomplete="one-time-code"
                    inputmode="numeric"
                    autofocus
                    required
                  />
                </div>
                <div class="d-grid gap-2">
                  <button type="submit" class="btn btn-primary">Enable 2FA</button>
                  <a href="{{ url_for('wallet.settings') }}" class="btn btn-secondary">Cancel</a>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
{% endblock %}
